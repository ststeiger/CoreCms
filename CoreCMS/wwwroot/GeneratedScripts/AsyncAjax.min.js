var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function s(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}(),Http;!function(Http){var RequestBase=function(){function t(){this.Complete=!1,this.m_SuccessCallbacks=[],this.m_CancelCallbacks=[],this.m_NetworkFailureCallbacks=[],this.m_FailureCallbacks=[],this.m_CompleteCallbacks=[],this.sendPromise.bind(this),this.sendRequest.bind(this),this.failureDefault.bind(this),this.successCallback.bind(this),this.cancelCallback.bind(this),this.networkFailureCallback.bind(this),this.failureCallback.bind(this),this.alwaysCallback.bind(this),this.success.bind(this),this.cancel.bind(this),this.networkFailure.bind(this),this.failure.bind(this),this.always.bind(this)}return t.prototype.successCallback=function(){this.Complete=!0;for(var t=0;t<this.m_SuccessCallbacks.length;++t)this.m_SuccessCallbacks[t].apply(this,arguments)},t.prototype.failureDefault=function(t){console.log("failure"),console.log(t);var e="Error "+t.status+" ("+t.statusText+"): \n\n";e+="URL: \n"+t.responseURL+"\n\n",e+=t.responseText,alert(e)},t.prototype.failureCallback=function(){this.Complete=!0,0===this.m_FailureCallbacks.length&&this.failureDefault.apply(this,arguments);for(var t=0;t<this.m_FailureCallbacks.length;++t)this.m_FailureCallbacks[t].apply(this,arguments)},t.prototype.cancelCallback=function(){this.Complete=!0;for(var t=0;t<this.m_CancelCallbacks.length;++t)this.m_CancelCallbacks[t].apply(this,arguments)},t.prototype.networkFailureCallback=function(){this.Complete=!0,0===this.m_NetworkFailureCallbacks.length&&this.failureDefault.apply(this,arguments);for(var t=0;t<this.m_NetworkFailureCallbacks.length;++t)this.m_NetworkFailureCallbacks[t].apply(this,arguments)},t.prototype.alwaysCallback=function(){this.Complete=!0;for(var t=0;t<this.m_CompleteCallbacks.length;++t)this.m_CompleteCallbacks[t].apply(this,arguments)},t.prototype.success=function(t){return null!=t?this.m_SuccessCallbacks.push(t):Error("Success-callback is NULL or UNDEFINED."),this},t.prototype.cancel=function(t){return null!=t?this.m_CancelCallbacks.push(t):Error("Cancel-callback is NULL or UNDEFINED."),this},t.prototype.networkFailure=function(t){return null!=t?this.m_NetworkFailureCallbacks.push(t):Error("Network-failure-callback is NULL or UNDEFINED."),this},t.prototype.failure=function(t){return null!=t?this.m_FailureCallbacks.push(t):Error("Failure-callback is NULL or UNDEFINED."),this},t.prototype.always=function(t){return null!=t?this.m_CompleteCallbacks.push(t):Error("Always-callback is NULL or UNDEFINED."),this},t.prototype.sendRequest=function(t){this.Complete=!1,null!=(t=t||{}).onNetworkError&&this.networkFailure(t.onNetworkError),null!=t.onError&&this.failure(t.onError),null!=t.onCancel&&this.cancel(t.onCancel),null!=t.onSuccess&&this.success(t.onSuccess),null!=t.onAlways&&this.always(t.onAlways),t.onSuccess=this.successCallback.bind(this),t.onError=this.failureCallback.bind(this),t.onCancel=this.cancelCallback.bind(this),t.onAlways=this.alwaysCallback.bind(this);var e=null,n=t.url;if(null==t.method&&(t.method="GET"),null==t.contentType&&(t.contentType="application/urlencode"),null!=t.cache&&0!=t.cache||(n+=(-1===t.url.indexOf("?")?"?":"&")+"no_cache="+(new Date).getTime()),null!=t.queryData)if("string"==typeof t.queryData||t.queryData instanceof String){var s=t.queryData;"?"!==s.substr(0,1)&&"&"!==s.substr(0,1)||(s=s.substr(1)),n+=(-1===t.url.indexOf("?")?"?":"&")+s}else{for(var o=[],r=0,l=Object.keys(t.queryData);r<l.length;r++)o.push(encodeURIComponent(l[r])+"="+encodeURIComponent(t.queryData[l[r]]));n+=(-1===t.url.indexOf("?")?"?":"&")+o.join("&")}if(null!=t.postData)if(null!=t.method&&"post"!==t.method.toLowerCase()&&Error("Can't have postData when method is not POST."),null==t.method&&(t.method="POST"),null==t.contentType&&(t.contentType="application/x-www-form-urlencoded"),-1!=t.contentType.indexOf("application/json"))e="string"==typeof t.postData||t.postData instanceof String?t.postData:JSON.stringify(e);else if("string"==typeof t.postData||t.postData instanceof String)e=t.postData;else{for(var o=[],r=0,l=Object.keys(t.postData);r<l.length;r++)o.push(encodeURIComponent(l[r])+"="+encodeURIComponent(t.postData[l[r]]));e=o.join("&")}var a=new XMLHttpRequest;if(null!=a){if(a.onerror=function(e){return console.log("req.onerror:",this,e),null!=t.onNetworkError?t.onNetworkError(a):null!=t.onError?t.onError(a):alert("There was an unexpected network error.\nSee the console log.\nError Details:\n"+e),t.onAlways(a),!1},null!=t.user&&null!=t.password?a.open(t.method,n,!0,t.user,t.password):a.open(t.method,n,!0),!0!==t.cache&&a.setRequestHeader("cache-control","no-cache"),null!=t.contentType&&a.setRequestHeader("Content-type",t.contentType),a.onreadystatechange=function(){if(4==a.readyState){if((200==a.status||304==a.status||0==a.status)&&null!=t.onSuccess)if(-1!==t.contentType.toLowerCase().indexOf("application/json")){var e=null,n=!1;try{e=JSON.parse(a.responseText),n=!0}catch(e){console.log(e.name),console.log(e.message),console.log(e.stack),console.log(e),console.log(a),console.log(a.responseText),null!=t.onError?t.onError(a):(alert("HTTP error "+a.status),console.log(a))}n&&(null==e.error?null!=t.onSuccess&&(null!=e.data?t.onSuccess(e.data):t.onSuccess(e)):null!=t.onError?(console.log('JSON-parsing successful - but result indicates "server error": ',JSON.stringify(e.error,null,2)),t.onError(e.error)):(console.log('JSON-parsing successful - but result indicates "server error": ',JSON.stringify(e.error,null,2)),alert("Server error:\n"+JSON.stringify(e.error,null,2))))}else{var s=a.responseText,o=!1;try{null!=t.resultHook&&(s=t.resultHook(s)),o=!0}catch(e){null!=t.onError?t.onError(a):alert("Result pre-processing error:\r\n"+e)}o&&null!=t.onSuccess&&t.onSuccess(s)}200!=a.status&&304!=a.status&&0!=a.status&&(null!=t.onError?t.onError(a):alert("HTTP error "+a.status)),304!==a.status&&0!==a.status||(null!=t.onCancel?t.onCancel(a):alert("HTTP request cancelled.")),t.onAlways&&t.onAlways(a)}},4!=a.readyState)return a.send(e),this}else null!=t.onError?t.onCancel(a):alert("Browser doesn't support XmlHttpRequest...")},t.prototype.sendPromise=function(t){return new Promise(function(e,n){t.onSuccess=function(t){e(t)},t.onError=function(t){console.log("onError",arguments),n(arguments)},t.onCancel=function(t){console.log("onCancel",arguments),n(arguments)},t.onAlways=function(t){},this.sendRequest(t)}.bind(this))},t.prototype.send=function(t){return this.sendRequest(t||this.m_params)},t.prototype.sendAsync=function(t){return this.sendPromise(t||this.m_params)},t}();Http.RequestBase=RequestBase;var Get=function(t){function e(e,n,s){var o=t.call(this)||this;return o.send.bind(o),o.sendAsync.bind(o),null!=s&&o.success(s),o.m_params={url:e,queryData:n,method:"GET"},o}return __extends(e,t),e}(RequestBase);Http.Get=Get;var Post=function(t){function e(e,n,s){var o=t.call(this)||this;return o.send.bind(o),o.sendAsync.bind(o),null!=s&&o.success(s),o.m_params={url:e,postData:n,method:"POST",contentType:"application/x-www-form-urlencoded"},o}return __extends(e,t),e}(RequestBase);Http.Post=Post;var PostEval=function(_super){function PostEval(url,data,success){var _this=_super.call(this)||this;return _this.send.bind(_this),_this.sendAsync.bind(_this),_this.m_params={url:url,postData:data,method:"POST",contentType:"application/x-www-form-urlencoded",resultHook:function(data){return eval("("+data+")")}.bind(_this)},_this}return __extends(PostEval,_super),PostEval}(RequestBase);Http.PostEval=PostEval;var PostJSON=function(t){function e(e,n,s){var o=t.call(this)||this;return o.send.bind(o),o.sendAsync.bind(o),o.m_params={url:e,postData:n,method:"POST",contentType:"application/x-www-form-urlencoded",resultHook:function(t){return JSON.parse(t)}.bind(o)},o}return __extends(e,t),e}(RequestBase);Http.PostJSON=PostJSON;var Json=function(t){function e(e,n,s){var o=t.call(this)||this;return o.send.bind(o),o.sendAsync.bind(o),null!=s&&o.success(s),o.m_params={url:e,method:"POST",contentType:"application/json; charset=UTF-8",postData:n},o}return __extends(e,t),e}(RequestBase);Http.Json=Json;var Ajax=function(t){function e(e){var n=t.call(this)||this;return n.send.bind(n),n.sendAsync.bind(n),n.m_params=e,n}return __extends(e,t),e}(RequestBase);Http.Ajax=Ajax;var JSONP=function(t){function e(e){var n=t.call(this)||this;return n.uuid.bind(n),n.removeElement.bind(n),n.sendRequest.bind(n),n.sendPromise.bind(n),null!=e&&(n.m_params=e),n}return __extends(e,t),e.prototype.uuid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.prototype.removeElement=function(t){var e=document.getElementById(t);null!=e&&e.parentElement.removeChild(e)},e.prototype.sendRequest=function(t){this.Complete=!1;var e=this.uuid();null!=t&&null!=t.url||Error("options or options.url not defined."),null!=t.onSuccess&&this.success(t.onSuccess),null!=t.onError?this.failure(t.onError):this.failure(function(e){alert('JsonP-request to "'+t.url+'" failed.'),console.log(e)}),null!=t.onAlways&&this.always(t.onAlways),null!=t.onCancel?this.cancel(t.onCancel):this.cancel(function(e){alert('JsonP-request to "'+t.url+'" timed out...'),console.log(e)}),t.onSuccess=this.successCallback.bind(this),t.onError=this.failureCallback.bind(this),t.onAlways=this.alwaysCallback.bind(this),t.onCancel=this.cancelCallback.bind(this);var n=t.url,s=t.callbackName||"callback",o=t.onSuccess||function(t){},r=t.onError||function(t){},l=t.onAlways||function(t){},a=t.onCancel||function(t){},i=t.timeout||10;if(-1==n.indexOf("?")?n+="?callback={@callback}":n+="&callback={@callback}",n=n.replace("{@callback}",encodeURIComponent(s)),null!=t.queryData)if("string"==typeof t.queryData||t.queryData instanceof String){var c=t.queryData;"?"!==c.substr(0,1)&&"&"!==c.substr(0,1)||(c=c.substr(1)),n+="&"+c}else{for(var u=[],p=0,h=Object.keys(t.queryData);p<h.length;p++)u.push(encodeURIComponent(h[p])+"="+encodeURIComponent(t.queryData[h[p]]));n+="&"+u.join("&")}var d=window.setTimeout(function(){window[s]=function(){},console.log("JSONP: script.ontimeout",arguments),a(arguments),l(arguments),this.removeElement(e)}.bind(this),1e3*i);window[s]=function(t){window.clearTimeout(d),o(t),l(t),this.removeElement(e)}.bind(this);var f=document.createElement("script");return f.id=e,f.type="application/javascript",f.async=!0,f.src=n,f.onerror=function(t,n){window.clearTimeout(d),console.log("JSONP: script.onerror",arguments),r(arguments),l(arguments),this.removeElement(e)}.bind(this),document.getElementsByTagName("head")[0].appendChild(f),this},e.prototype.sendPromise=function(t){return("string"==typeof t||t instanceof String)&&(t={url:t}),null!=t&&null!=t.url||Error("options or options.url not defined."),new Promise(function(e,n){t.onSuccess=function(t){e(t)},t.onError=function(){console.log("onError",arguments),n(arguments)},t.onCancel=function(){console.log("onCancel",arguments),n(arguments)},this.sendRequest(t)}.bind(this))},e}(RequestBase);Http.JSONP=JSONP}(Http||(Http={}));