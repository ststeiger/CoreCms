"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(o,s)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,a=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(e){r=[6,e],a=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},VT;!function(e){var t=function(){function e(e){this.m_refetch=!1,this.autoBind(this),this.m_refetch=!1,this.m_url=e.url,this.m_container="string"==typeof e.id||e.id instanceof String?document.querySelector(e.id):e.id,this.m_tree=this.m_container.appendChild(this.create("ul",{className:"vtree"})),this.m_placeholder=e&&e.placeholder,this._placeholder(),this.m_leafs={},this.m_tree.addEventListener("click",function(e){e.target.classList.contains("vtree-leaf-label")?this.select(e.target.parentNode.getAttribute("data-vtree-id")):e.target.classList.contains("vtree-toggle")&&this.toggle(e.target.parentNode.getAttribute("data-vtree-id"))}.bind(this)),e&&e.contextmenu&&(this.m_tree.addEventListener("contextmenu",function(t){var r,n=this.m_tree.querySelectorAll(".vtree-contextmenu");if([].forEach.call(n,function(e){e.parentElement.removeChild(e)}),t.target.classList.contains("vtree-leaf-label")){t.preventDefault(),t.stopPropagation(),r=this.create("menu",{className:"vtree-contextmenu"});var i=t.target.getBoundingClientRect();this.setProperties(r.style,{top:(t.target.offsetTop+i.height).toString()+"px",left:t.target.offsetLeft.toString()+"px",display:"block"}),e.contextmenu.forEach(function(e){r.appendChild(this.create("li",{className:"vtree-contextmenu-item",innerHTML:e.label})).addEventListener("click",e.action.bind(e,t.target.parentElement.getAttribute("data-vtree-id")))}.bind(this)),t.target.parentElement.appendChild(r)}}.bind(this)),document.addEventListener("click",function(e){var t=this.m_tree.querySelectorAll(".vtree-contextmenu");[].forEach.call(t,function(e){e.parentElement.removeChild(e)})}.bind(this)))}return e.prototype.autoBind=function(e){for(var t=0,r=Object.getOwnPropertyNames(e.constructor.prototype);t<r.length;t++){var n=r[t],i=e[n];"constructor"!==n&&"function"==typeof i&&(e[n]=i.bind(e))}return e},e.prototype.setProperties=function(e,t){if(t)for(var r=0,n=Object.keys(t);r<n.length;r++)e[n[r]]=t[n[r]];return e},e.prototype.create=function(e,t){return this.setProperties(document.createElement(e),t)},e.prototype.dispatchEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){try{r=new CustomEvent("vtree-"+e,{bubbles:!0,cancelable:!0,detail:{id:t}})}catch(n){(r=document.createEvent("CustomEvent")).initCustomEvent("vtree-"+e,!0,!0,{id:t})}return(this.getLeaf(t,!0)||this.m_tree).dispatchEvent(r),[2,new Promise(function(e,t){e(this)}.bind(this))]})})},e.prototype._placeholder=function(){var e;return!this.m_tree.children.length&&this.m_placeholder?this.m_tree.innerHTML='<li class="vtree-placeholder">'+this.m_placeholder+"</li>":(e=this.m_tree.querySelector(".vtree-placeholder"))&&this.m_tree.removeChild(e),this},e.prototype.getLeaf=function(e,t){var r=this.m_tree.querySelector('[data-vtree-id="'+e+'"]');if(!t&&!r)throw Error('No VanillaTree leaf with id "'+e+'"');return r},e.prototype.getChildList=function(e){var t,r;return e?(t=(r=this.getLeaf(e)).querySelector("ul"))||(t=r.appendChild(this.create("ul",{className:"vtree-subtree"}))):t=this.m_tree,t},e.prototype.add=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i;return __generator(this,function(a){return r=this.create("li",{className:e.hasChildren?"vtree-leaf vtree-has-children":"vtree-leaf"}),n=this.getChildList(e.parent),r.setAttribute("data-vtree-id",t=e.id||Math.random().toString()),r.appendChild(this.create("span",{className:"vtree-toggle"})),i=document.createElement("a"),i.className="vtree-leaf-label",i.appendChild(document.createTextNode(e.text)),r.appendChild(i),n.appendChild(r),n!==this.m_tree&&n.parentElement.classList.add("vtree-has-children"),this.m_leafs[t]=e,e.opened||this.close(t),e.selected&&this.select(t),[2,this._placeholder().dispatchEvent("add",t)]})})},e.prototype.move=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(a){return r=this.getLeaf(e),n=r.parentElement,(i=this.getLeaf(t,!0))&&i.classList.add("vtree-has-children"),this.getChildList(t).appendChild(r),n.parentElement.classList.toggle("vtree-has-children",!!n.children.length),[2,this.dispatchEvent("move",e)]})})},e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){return t=this.getLeaf(e),(r=t.parentElement).removeChild(t),r.parentElement.classList.toggle("vtree-has-children",!!r.children.length),[2,this._placeholder().dispatchEvent("remove",e)]})})},e.prototype.newId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.addBranch=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:t=null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,new Http.PostJSON("treedata",{id:e}).sendAsync()];case 2:for(t=i.sent(),r=0;r<t.Rows.length;++r)t.Rows[r].parent=e,this.add(t.Rows[r]);return[3,4];case 3:return n=i.sent(),console.log(n),alert("error fetching branch data\n"+n),[3,4];case 4:return[2,t]}})})},e.prototype.open=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return t=this.getLeaf(e),r=t.getElementsByTagName("ul")||[],t.classList.remove("closed"),0!=r.length?[3,2]:[4,this.addBranch(e)];case 1:return i.sent(),[3,4];case 2:if(!this.m_refetch)return[3,4];for(n=0;n<r.length;++n)t.removeChild(r[n]);return[4,this.addBranch(e)];case 3:i.sent(),i.label=4;case 4:return[2,this.dispatchEvent("open",e)]}})})},e.prototype.close=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.getLeaf(e).classList.add("closed"),[2,this.dispatchEvent("close",e)]})})},e.prototype.toggle=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this[this.getLeaf(e).classList.contains("closed")?"open":"close"](e)]})})},e.prototype.select=function(e){var t,r=this.getLeaf(e);return r.classList.contains("vtree-selected")?new Promise(function(e,t){e(this)}.bind(this)):(t=this.m_tree.querySelectorAll("li.vtree-leaf"),[].forEach.call(t,function(e){e.classList.remove("vtree-selected")}),r.classList.add("vtree-selected"),this.dispatchEvent("select",e))},e}();e.VanillaTree=t}(VT||(VT={}));